import pandas as pd
import pytest
from unittest.mock import patch, MagicMock
from diary.diary_excel import save_diary_excel

def test_save_diary_excel():
    # Creazione di dati di esempio per il diario
    diary = [
        {"date": "2024-08-15", "event": "Meeting", "calendar": "Work"},
        {"date": "2024-08-16", "event": "Dentist", "calendar": "Personal"}
    ]

    # Mock del metodo to_excel
    with patch.object(pd.DataFrame, 'to_excel') as mock_to_excel:
        # Esegui la funzione
        save_diary_excel("dummy_path.xlsx", diary)

        # Verifica che to_excel sia stato chiamato con il percorso corretto e che index=False sia stato passato
        mock_to_excel.assert_called_once_with("dummy_path.xlsx", index=False)

        # Estrai l'argomento che Ã¨ stato passato a DataFrame.to_excel
        df = mock_to_excel.call_args[0][0]

        # Ricrea il DataFrame originale per il confronto
        expected_df = pd.DataFrame(diary).drop(columns=['calendar'])

        # Ora verifichiamo che il DataFrame sia corretto
        pd.testing.assert_frame_equal(df, expected_df)

